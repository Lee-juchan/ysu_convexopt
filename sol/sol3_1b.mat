clear all; close all; clc;
load data/hw3_prob1b

% [m n] = size(A)

n= size(x_orig,1);
MaxIter=5000;
TOL=1e-4;
lambda=2;

t= 1/norm(A)^2
x= zeros(size(x_orig));
W= ones(n,1); % Weighting matrix (initially 1 for all elements)
delta=10;

for rwt=1:2
    y=x;
    if rwt==1;
        W= ones(n,1);
    else
        W= 1./ (abs(y)+delta); % update reweighting matrix
    end

    for iter=1:MaxIter
        iter

        % -- update x and z
        TH= lambda*t;
        f(iter)= 0.5*norm(A*y-d)^2 + lambda*norm(W.*y,1);
        grad_g= A'*(A*y-d);
        temp_y= y - t * grad_g;

        x= (abs(temp_y)> (W.*TH)).*((abs(temp_y)-(W.*TH)).*sign(temp_y));
        hist_x_rwt(iter)= norm(x-x_orig);
        hist_residue_rwt(iter)= norm(d-A*x);

        % -- stopping criterion
        if iter>10 && norm(x-x_old)/norm(x)<TOL
            break;
        end

        % -- Accelerated process
        if iter>=2;
            y= x+ (iter/(iter+3))*(x-x_old);
        end
        x_old= x;
    end

    if rwt==1;
        x1= y;
    else
        x_final=y;
    end
end
x_rwt=x;

figure(); plot(x_orig,'o'); hold on; plot(x1,'x'); hold off;
title('Reconstructed by L1-norm');

figure(); plot(x_orig,'o'); hold on; plot(x_final,'x'); hold off;
title('Reconstructed by Reweighted L1');