clear all; close all; clc;
load data/hw3_prob1a.mat

[m n] = size(A)


%% Conventional L1-norm (ISTA)
MaxIter=10000;
TOL=1e-4;
lambda= 2;

t= 1/norm(A)^2
x=zeros(n,1);

for iter=1:MaxIter
    iter
    
    f(iter)= 0.5*norm(A*x-b)^2 + lambda*norm(x,1);
    grad_g= A'*(A*x-b);
    temp_x= x - t*grad_g;
    
    % -- update x and z
    TH= lambda*t;
    x= (abs(temp_x)> TH).*((abs(temp_x)-TH).*sign(temp_x));
    hist_x(iter)= norm(x-x_orig);
    hist_residue(iter)= norm(b-A*x);
    
    % -- stopping criterion
    if iter>1 && norm(x_old-x)/norm(x)<TOL
        break;
    end

    x_old= x;
end

x_conv=x;



%% Accelerated L1-norm (FISTA)
x=zeros(n,1);
y=x;

for iter=1:MaxIter
    iter

    % -- update x and z
    TH= lambda*t;
    f(iter)= 0.5*norm(A*y-b)^2 + lambda*norm(y,1);
    grad_g= A'*(A*y-b);
    temp_y= y - t*grad_g;

    x= (abs(temp_y)> TH).*((abs(temp_y)-TH).*sign(temp_y));
    hist_x_acc(iter)= norm(x-x_orig);
    hist_residue_acc(iter)= norm(b-A*x);

    % -- stopping criterion
    if iter>10 && norm(x_old-x)/norm(x)<TOL
        break;
    end
    if iter>=2;
        y= x+ (iter/(iter+3))*(x-x_old);
    end
    x_old= x;
end

x_acc=x;



%% Plotting
figure(); plot(x_orig,'o'); hold on; plot(x_conv,'x'); hold off;
title('Conventional L1 (ISTA)'); legend('Original','Reconstructed');

figure(); plot(x_orig,'o'); hold on; plot(x_acc,'x'); hold off;
title('Accelerated L1 (FISTA)'); legend('Original','Reconstructed');

figure(); semilogy(hist_x); hold on; semilogy(hist_x_acc,'r'); hold off;
title(' ||x-x orig||'); legend('ISTA','FISTA');

figure(); semilogy(hist_residue); hold on;
semilogy(hist_residue_acc,'r'); hold off; title(' ||Ax-d||')